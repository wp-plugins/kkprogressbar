var kkpbAddForm={valid:"",progressFormVal:null,progressbarTab:[],progressbarCount:0,count:0,isEdit:!1,initialize:function(b){_this=this;this.options=b;if(""!=this.options.editID.val())this.isEdit=!0;if(void 0!=jQuery("#kkpb-box .kkpb-progressbar-box:visible")&&0<jQuery("#kkpb-box .kkpb-progressbar-box:visible").length)_this.count=jQuery("#kkpb-box .kkpb-progressbar-box:visible").length;this.validationInit();this.disabledInputs("#kkpb_name, #kkpb_val_all, #kkpb_val_now, #kkpb_name_dialog, #kkpb_val_all_dialog, #kkpb_val_now_dialog"); this.options.openFormButton.click(function(){_this.openFormBox(_this.options.formBox,_this.options.progressbarManual);_this.enabledInputs("#kkpb_name");return!1});jQuery(".kkpb-auto").live("change",function(){jQuery(this).is(":checked")?jQuery(this).parents("#kkpb-add-bar-form").find(".kkpb-auto-row").fadeOut("fast",function(){jQuery(this).parents("#kkpb-add-bar-form").find(".kkpb-progress-row").fadeIn("fast");_this.disabledInputs("#kkpb_val_all, #kkpb_val_now");_this.enabledInputs("#kkpb_procent")}): jQuery(this).parents("#kkpb-add-bar-form").find(".kkpb-progress-row").fadeOut("fast",function(){jQuery(this).parents("#kkpb-add-bar-form").find(".kkpb-auto-row").fadeIn("fast");_this.enabledInputs("#kkpb_val_all, #kkpb_val_now");_this.disabledInputs("#kkpb_procent")})});jQuery("#kkpb-auto-dialog").live("change",function(){jQuery(this).is(":checked")?jQuery(this).parents("#kkpb-edit-progressbar-dialog").find(".kkpb-auto-row").fadeOut("fast",function(){jQuery(this).parents("#kkpb-edit-progressbar-dialog").find(".kkpb-progress-row").fadeIn("fast"); _this.disabledInputs("#kkpb_val_all_dialog, #kkpb_val_now_dialog");_this.enabledInputs("#kkpb_procent_dialog")}):jQuery(this).parents("#kkpb-edit-progressbar-dialog").find(".kkpb-progress-row").fadeOut("fast",function(){jQuery(this).parents("#kkpb-edit-progressbar-dialog").find(".kkpb-auto-row").fadeIn("fast");_this.enabledInputs("#kkpb_val_all_dialog, #kkpb_val_now_dialog");_this.disabledInputs("#kkpb_procent_dialog")})});this.options.closeFormButton.click(function(){_this.closeFormBox(_this.options.formBox); _this.disabledInputs("#kkpb_name, #kkpb_val_all, #kkpb_val_now");return!1});this.options.addProgressButton.click(function(){var a=_this.options.progressbarName.is(":enabled")?_this.options.progressbarName.valid():!0,b=_this.options.progressbarPercent.is(":enabled")?_this.options.progressbarPercent.valid():!0,c=_this.options.progressbarVallAll.is(":enabled")?_this.options.progressbarVallAll.valid():!0,e=_this.options.progressbarVallNow.is(":enabled")?_this.options.progressbarVallNow.valid():!0;if(!a|| !c||!e||!b)return!1;_this.isEdit?_this.addProgressbarBox(_this.options.editID.val()):_this.addProgressbarBox("");return!1});this.options.statusHendler.live("click",function(){var a=jQuery(this);_this.changeStatusIMG(a);_this.isEdit&&_this.updateStatusAjax(a);return!1});this.options.deleteHendler.live("click",function(){_this.deleteProgressbar(jQuery(this));return!1});this.options.editHendler.live("click",function(){var a=jQuery(this),b=0,c=a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputName+ '"]').val(),e=a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputManual+'"]').val(),f=a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputPercent+'"]').val(),g=a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputVallAll+'"]').val(),i=a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputVallNow+'"]').val();"1"==e?_this.options.progressbarManualDialog.attr({checked:"checked"}):"2"==e&&_this.options.progressbarManualDialog.attr({checked:!1}); _this.options.progressbarNameDialog.val(c);_this.options.progressbarPercentDialog.val(f);_this.options.progressbarVallAllDialog.val(g);_this.options.progressbarVallNowDialog.val(i);_this.options.dialogBox.dialog("destroy");_this.options.dialogBox.dialog({height:300,width:500,modal:!0,open:function(){_this.options.progressbarManualDialog.change();_this.enabledInputs("#kkpb_name_dialog");_this.options.sliderClass.slider({min:0,max:100,step:1,value:f});_this.refreshCheckboxPlugin(_this.options.progressbarManualDialog)}, buttons:{Save:function(){var c=_this.options.progressbarNameDialog.is(":enabled")?_this.options.progressbarNameDialog.valid():!0,h=_this.options.progressbarPercentDialog.is(":enabled")?_this.options.progressbarPercentDialog.valid():!0,f=_this.options.progressbarVallAllDialog.is(":enabled")?_this.options.progressbarVallAllDialog.valid():!0,g=_this.options.progressbarVallNowDialog.is(":enabled")?_this.options.progressbarVallNowDialog.valid():!0;if(!c||!f||!g||!h)return!1;c=a.attr("href");c=c.split("#"); c=c[1];_this.options.progressbarManualDialog.is(":checked")?(e=1,b=_this.options.progressbarPercentDialog.val()):(e=2,b=100*(parseInt(_this.options.progressbarVallNowDialog.val())/_this.options.progressbarVallAllDialog.val()));h=100<parseInt(b)?100:parseInt(b);a.parents(".kkpb-progressbar-box").find(_this.options.nameClass).html(_this.options.progressbarNameDialog.val());a.parents(".kkpb-progressbar-box").find(_this.options.percentInfo).attr({title:b+"%"});a.parents(".kkpb-progressbar-box").find(_this.options.progressWidth).css({width:h+ "%"});a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputName+'"]').val(_this.options.progressbarNameDialog.val());a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputManual+'"]').val(e);a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputPercent+'"]').val(_this.options.progressbarPercentDialog.val());a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputVallAll+'"]').val(_this.options.progressbarVallAllDialog.val()); a.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputVallNow+'"]').val(_this.options.progressbarVallNowDialog.val());_this.isEdit&&(c={action:"update_bar_kkpb",id:c,nazwa:_this.options.progressbarNameDialog.val(),link:_this.options.progressbarNameLinkDialog.val(),manual:e,procent:_this.options.progressbarPercentDialog.val(),valNow:_this.options.progressbarVallNowDialog.val(),valAll:_this.options.progressbarVallAllDialog.val()},_this.ajaxLoading(),jQuery.post(ajaxurl,c,function(a){_this.ajaxLoading(); a=jQuery.parseJSON(a);a.hasError?_this.ajaxError():_this.ajaxOK();_this.options.dialogBox.dialog("close")}));_this.options.dialogBox.dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})})},validationInit:function(){jQuery("#kkpb-add-form").validate({rules:{kkpb_project_name:{required:!0},kkpb_project_link:{required:!1},kkpb_name:{required:!0},kkpb_val_all:{required:!0,onlyDigits:!0,moreThenZero:!0},kkpb_val_now:{required:!0,onlyDigits:!0,moreThenZero:!0,mniejszaOd:"#kkpb_val_all"}, kkpb_procent:{required:!0,onlyDigits:!0}},errorPlacement:function(b,a){a.parent().append('<div class="clear"></div>');var d=a.attr("name");b.attr("id",d+"_error");b.appendTo(a.parent())}});jQuery("#kkpb-edit-progress-box").validate({rules:{kkpb_name_dialog:{required:!0},kkpb_val_all_dialog:{required:!0,onlyDigits:!0,moreThenZero:!0},kkpb_val_now_dialog:{required:!0,onlyDigits:!0,moreThenZero:!0,mniejszaOd:"#kkpb_val_all_dialog"},kkpb_procent_dialog:{required:!0,onlyDigits:!0}},errorPlacement:function(b, a){a.parent().append('<div class="clear"></div>');var d=a.attr("name");b.attr("id",d+"_error");b.appendTo(a.parent())}})},disabledInputs:function(b){jQuery(b).attr({disabled:"disabled"})},enabledInputs:function(b){jQuery(b).attr({disabled:!1})},updateStatusAjax:function(b){var a=b.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputStatus+'"]').val(),b=b.parents(".kkpb-progressbar-box").find(_this.options.progressBoxOptions).attr("href"),b=b.split("#"),b=b[1],a={action:"zmiana_statusu_kkpb", id:b,status:a};_this.ajaxLoading();jQuery.post(ajaxurl,a,function(a){_this.ajaxLoading();a=jQuery.parseJSON(a);if(a.hasError)return _this.ajaxError(),!1})},changeStatusIMG:function(b){var a=b.attr("class");"kkpb-status-aktywny"==a?(b.removeClass().addClass("kkpb-status-wstrzymany"),b.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputStatus+'"]').val("2")):"kkpb-status-wstrzymany"==a?(b.removeClass().addClass("kkpb-status-nieaktywny"),b.parents(".kkpb-progressbar-box").find('input[name="'+ _this.options.inputStatus+'"]').val("3")):"kkpb-status-nieaktywny"==a&&(b.removeClass().addClass("kkpb-status-aktywny"),b.parents(".kkpb-progressbar-box").find('input[name="'+_this.options.inputStatus+'"]').val("1"))},ajaxLoading:function(){jQuery(".kkpb-ajax-ok").hide();jQuery(".kkpb-ajax-error").hide();jQuery(".kkpb-ajax-loading").is(":visible")?jQuery(".kkpb-ajax-loading").hide():jQuery(".kkpb-ajax-loading").show()},ajaxError:function(){jQuery(".kkpb-ajax-loading").hide();jQuery(".kkpb-ajax-ok").hide(); jQuery(".kkpb-ajax-error").show()},ajaxOK:function(){jQuery(".kkpb-ajax-loading").hide();jQuery(".kkpb-ajax-error").hide();jQuery(".kkpb-ajax-ok").show()},deleteProgressbar:function(b){var a=b.attr("href"),a=a.split("#"),a=a[1];_this.isEdit&&_this.deleteProgressbarAjax(a);_this.removeBox(b.parents(_this.options.progressbarBoxClass))},deleteProgressbarAjax:function(b){b={action:"del_bar_kkpb",id:b};_this.ajaxLoading();jQuery.post(ajaxurl,b,function(a){_this.ajaxLoading();a=jQuery.parseJSON(a);if(a.hasError)return _this.ajaxError(), !1;_this.ajaxOK()})},removeBox:function(b){b.fadeOut("normal",function(){b.remove();_this.count--})},addProgressbarBox:function(b){var a,d,c;_this.progressbarTab=[];_this.getFormValues();_this.progressbarTab.push(_this.progressFormVal);_this.progressFormVal.manual?(d=100*(parseInt(_this.progressFormVal.manualNow)/parseInt(_this.progressFormVal.manualAll)),c=2):(d=_this.progressFormVal.percentage,c=1);if(2<=_this.count||0>_this.count)return alert("In the free version you can add two tasks for each project. Feel free to purchase the professional version."), !1;_this.count++;""!=b?(b={action:"add_bar_kkpb",nazwa:_this.progressFormVal.name,manual:c,procent:_this.progressFormVal.percentage,valAll:_this.progressFormVal.manualAll,valNow:_this.progressFormVal.manualNow,status:"1",proId:b},_this.ajaxLoading(),jQuery.post(ajaxurl,b,function(b){_this.ajaxLoading();b=jQuery.parseJSON(b);b.hasError?_this.ajaxError():(_this.ajaxOK(),_this.progressbarCount=b.id,b=100<parseInt(d)?100:parseInt(d),a=_this.options.progressbarBoxPrototype.clone(),a.attr({id:""}).find(_this.options.nameClass).html(_this.progressFormVal.name), a.find(_this.options.percentInfo).attr({title:d+"%"}),a.find(_this.options.progressWidth).css({width:b+"%"}),a.find(_this.options.progressBoxOptions).attr({href:"#"+_this.progressbarCount}),a.find('input[name="'+_this.options.inputName+'"]').val(_this.progressFormVal.name),a.find('input[name="'+_this.options.inputManual+'"]').val(_this.progressFormVal.manual),a.find('input[name="'+_this.options.inputPercent+'"]').val(_this.progressFormVal.percentage),a.find('input[name="'+_this.options.inputVallAll+ '"]').val(_this.progressFormVal.manualAll),a.find('input[name="'+_this.options.inputVallNow+'"]').val(_this.progressFormVal.manualNow),_this.progressbarCount++,_this.options.progressbarBoxBox.append(a.fadeIn()))})):(b=100<parseInt(d)?100:parseInt(d),a=_this.options.progressbarBoxPrototype.clone(),a.attr({id:""}).find(_this.options.nameClass).html(_this.progressFormVal.name),a.find(_this.options.percentInfo).attr({title:d+"%"}),a.find(_this.options.progressWidth).css({width:b+"%"}),a.find(_this.options.progressBoxOptions).attr({href:"#"+ _this.progressbarCount}),a.find('input[name="'+_this.options.inputName+'"]').val(_this.progressFormVal.name),a.find('input[name="'+_this.options.inputManual+'"]').val(_this.progressFormVal.manual),a.find('input[name="'+_this.options.inputPercent+'"]').val(_this.progressFormVal.percentage),a.find('input[name="'+_this.options.inputVallAll+'"]').val(_this.progressFormVal.manualAll),a.find('input[name="'+_this.options.inputVallNow+'"]').val(_this.progressFormVal.manualNow),_this.progressbarCount++,_this.options.progressbarBoxBox.append(a.fadeIn()))}, getFormValues:function(){var b,a,d,c;_this.options.progressbarManual.is(":checked")?(b=!1,a=_this.options.progressbarPercent.val(),c=d=0):(b=!0,a=0,d=_this.options.progressbarVallAll.val(),c=_this.options.progressbarVallNow.val());_this.progressFormVal={name:_this.options.progressbarName.val(),manual:b,percentage:a,manualAll:d,manualNow:c}},openFormBox:function(b,a){b.slideDown("normal",function(){_this.refreshCheckboxPlugin(a)})},closeFormBox:function(b){b.slideUp("normal")},refreshCheckboxPlugin:function(b){b.iphoneStyle()}}; function kkpbAddFormConstr(){this.kkpbAddForm=kkpbAddForm};